<Page
    x:Class = "Connect.UI.Views.Ticket.Control.TicketControlView"
    xmlns = "http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x = "http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c = "http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d = "http://schemas.microsoft.com/expression/blend/2008"
    xmlns:u = "http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:l = "clr-namespace:Connect.UI.Views.Ticket"
    xmlns:upsert = "clr-namespace:Connect.UI.Views.Ticket.Upsert"
    xmlns:control = "clr-namespace:Connect.UI.Views.Ticket.Control"
    xmlns:dataModels = "clr-namespace:Connect.Data.Models;assembly=Connect.Data"
    xmlns:components = "clr-namespace:Connect.UI.Views.Ticket.Control.Components"
    c:Ignorable = "d"
    Title = "TicketControlView"
    ScrollViewer.VerticalScrollBarVisibility = "Disabled"
    ScrollViewer.HorizontalScrollBarVisibility = "Disabled"
    ScrollViewer.CanContentScroll = "False"
    u:Design.Background = "{DynamicResource ApplicationBackgroundBrush}"
    u:Design.Foreground = "{DynamicResource TextFillColorPrimaryBrush}"
    Foreground = "{DynamicResource TextFillColorPrimaryBrush}"
    d:DataContext = "{d:DesignInstance control:TicketControlViewModel}"
    d:DesignHeight = "800"
    d:DesignWidth = "1252">
    <Grid
        VerticalAlignment = "Top"
        MaxWidth = "1252"
        Margin = "32">
        <Grid.RowDefinitions>
            <RowDefinition
                Height = "Auto" />
            <RowDefinition
                Height = "12" />
            <RowDefinition
                Height = "*" />
        </Grid.RowDefinitions>

        <Grid
            HorizontalAlignment = "Right"
            Grid.Row = "0">
            <StackPanel
                Orientation = "Horizontal">
                <components:FilterButtonControl
                    x:Name = "FilterButtonControl"
                    d:DataContext = "{Binding}"
                    ViewModel = "{Binding}" />

            </StackPanel>
        </Grid>

        <u:CardControl
            Grid.Row = "2"
            CornerRadius = "8">
            <u:CardControl.Header>
                <u:ListView
                    x:Name = "TicketList">
                    <ScrollViewer.HorizontalScrollBarVisibility>
                        Disabled
                    </ScrollViewer.HorizontalScrollBarVisibility>
                    <u:ListView.ItemTemplate>
                        <DataTemplate
                            DataType = "{x:Type dataModels:Ticket}">
                            <u:CardControl
                                Margin = "0,0,0,6"
                                CornerRadius = "8">
                                <u:CardControl.Header>
                                    <Grid
                                        Margin = "12,8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition
                                                Height = "Auto" />
                                            <RowDefinition
                                                Height = "Auto" />
                                            <RowDefinition
                                                Height = "Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition
                                                Width = "Auto" />
                                            <ColumnDefinition
                                                Width = "*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Icon -->
                                        <Grid
                                            Grid.RowSpan = "3"
                                            Width = "32"
                                            Height = "32"
                                            HorizontalAlignment = "Center"
                                            VerticalAlignment = "Top">
                                            <Ellipse
                                                Width = "32"
                                                Height = "32"
                                                Fill = "{DynamicResource ControlElevationBorderBrush}" />
                                            <u:SymbolIcon
                                                Symbol = "ClipboardBulletListLtr20"
                                                FontSize = "16"
                                                HorizontalAlignment = "Center"
                                                VerticalAlignment = "Center" />
                                        </Grid>

                                        <!-- Header: Category and CreatedAt -->
                                        <StackPanel
                                            Grid.Row = "0"
                                            Grid.Column = "1"
                                            Orientation = "Horizontal"
                                            VerticalAlignment = "Center"
                                            Margin = "12,0,0,0">
                                            <TextBlock
                                                Text = "{Binding CategoryFormatted, Mode=OneWay}"
                                                FontWeight = "SemiBold"
                                                FontSize = "13"
                                                Foreground = "{DynamicResource TextFillColorPrimaryBrush}" />
                                            <TextBlock
                                                Text = "•"
                                                Margin = "6,0"
                                                Foreground = "{DynamicResource TextFillColorTertiaryBrush}" />
                                            <TextBlock
                                                Text = "{Binding CreatedAtFormatted, Mode=OneWay}"
                                                FontSize = "12"
                                                Foreground = "{DynamicResource TextFillColorSecondaryBrush}" />
                                        </StackPanel>

                                        <!-- Heading -->
                                        <TextBlock
                                            Grid.Row = "1"
                                            Grid.Column = "1"
                                            Margin = "12,2,0,0"
                                            FontSize = "15"
                                            FontWeight = "Bold"
                                            Text = "{Binding Heading}"
                                            TextWrapping = "NoWrap"
                                            TextTrimming = "CharacterEllipsis"
                                            Foreground = "{DynamicResource TextFillColorPrimaryBrush}" />

                                        <!-- Content and Attachments -->
                                        <StackPanel
                                            Grid.Row = "2"
                                            Grid.Column = "1"
                                            Margin = "12,4,0,4"
                                            Orientation = "Vertical">
                                            <TextBlock
                                                Text = "{Binding Content}"
                                                FontSize = "13"
                                                TextWrapping = "Wrap"
                                                TextTrimming = "CharacterEllipsis"
                                                MaxHeight = "60"
                                                Foreground = "{DynamicResource TextFillColorTertiaryBrush}" />

                                            <Grid
                                                Margin = "0,6,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width = "*" />
                                                    <ColumnDefinition
                                                        Width = "Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Status Badge -->
                                                <Border
                                                    Grid.Column = "0"
                                                    HorizontalAlignment = "Left"
                                                    CornerRadius = "12"
                                                    Padding = "8,2"
                                                    Margin = "0,0,0,0">
                                                    <Border.Style>
                                                        <Style
                                                            TargetType = "Border">
                                                            <Setter
                                                                Property = "Background"
                                                                Value = "#3B82F6" />
                                                            <Style.Triggers>
                                                                <DataTrigger
                                                                    Binding = "{Binding Status}"
                                                                    Value = "Active">
                                                                    <Setter
                                                                        Property = "Background"
                                                                        Value = "#3B82F6" />
                                                                </DataTrigger>
                                                                <DataTrigger
                                                                    Binding = "{Binding Status}"
                                                                    Value = "Cancelled">
                                                                    <Setter
                                                                        Property = "Background"
                                                                        Value = "#F59E0B" />
                                                                </DataTrigger>
                                                                <DataTrigger
                                                                    Binding = "{Binding Status}"
                                                                    Value = "Completed">
                                                                    <Setter
                                                                        Property = "Background"
                                                                        Value = "#10B981" />
                                                                </DataTrigger>
                                                                <DataTrigger
                                                                    Binding = "{Binding Status}"
                                                                    Value = "Sent">
                                                                    <Setter
                                                                        Property = "Background"
                                                                        Value = "#6B7280" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock
                                                        Text = "{Binding Status}"
                                                        FontSize = "12"
                                                        FontWeight = "Medium"
                                                        Foreground = "White" />
                                                </Border>

                                                <!-- File Attachments -->
                                                <StackPanel
                                                    Grid.Column = "1"
                                                    Orientation = "Horizontal"
                                                    HorizontalAlignment = "Right"
                                                    VerticalAlignment = "Center">
                                                    <u:SymbolIcon
                                                        Symbol = "Attach20"
                                                        FontSize = "14"
                                                        Margin = "0,0,4,0"
                                                        Foreground = "{DynamicResource TextFillColorTertiaryBrush}" />
                                                    <TextBlock
                                                        Text = "{Binding FileAttachments.Count, StringFormat='{}{0} files'}"
                                                        FontSize = "12"
                                                        Foreground = "{DynamicResource TextFillColorSecondaryBrush}" />
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                </u:CardControl.Header>
                            </u:CardControl>
                        </DataTemplate>
                    </u:ListView.ItemTemplate>

                    <u:ListView.ItemContainerStyle>
                        <Style
                            TargetType = "ListViewItem">
                            <Setter
                                Property = "Focusable"
                                Value = "False" />
                            <Setter
                                Property = "Background"
                                Value = "Transparent" />
                            <Setter
                                Property = "BorderThickness"
                                Value = "0" />
                            <Setter
                                Property = "Template">
                                <Setter.Value>
                                    <ControlTemplate
                                        TargetType = "ListViewItem">
                                        <ContentPresenter />
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </u:ListView.ItemContainerStyle>
                </u:ListView>
            </u:CardControl.Header>
        </u:CardControl>
    </Grid>
</Page>
